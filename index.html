<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toko Obat Bintan Jaya - Official Web</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00b894">
    <link rel="apple-touch-icon" href="icon-512.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- TEMA MEDICAL PROFESSIONAL V37.0 (FIX WA & LOGO BSI) --- */
        :root { 
            --primary: #00b894;        
            --primary-dark: #00a884;   
            --secondary: #0984e3;      
            --dark: #2d3436; 
            --light: #f1f2f6; 
            --wa-color: #25D366; 
            --promo-red: #ff7675;
            --shadow-soft: 0 10px 20px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background: var(--light); color: var(--dark); padding-bottom: 0; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }

        /* === CSS TAMBAHAN UNTUK VARIAN & BADGE === */
        .variant-container { margin: 15px 0; }
        .variant-label { font-weight: 600; font-size: 0.85rem; margin-bottom: 8px; display: block; }
        .variant-options { display: flex; flex-wrap: wrap; gap: 8px; }
        
        .var-btn {
            padding: 8px 15px;
            border: 1px solid #dfe6e9;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            position: relative;
        }
        .var-btn:hover { border-color: var(--primary); }
        .var-btn.active { background: #e0f2f1; border-color: var(--primary); color: var(--primary-dark); font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .var-btn.disabled { 
            background: #f1f2f6; color: #b2bec3; border-color: #eee; 
            cursor: not-allowed; text-decoration: line-through; opacity: 0.7;
        }

        /* === MODAL IMAGE & BADGE === */
        .modal-img-container {
            flex: 1;
            width: 100%;
            aspect-ratio: 1 / 1; 
            max-height: 300px; 
            background: #f8f9fa;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
            margin-bottom: 10px;
        }

        #modal-img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .modal-badge-mini {
            position: absolute;
            top: 15px; left: 15px;
            padding: 3px 10px;
            border-radius: 4px;
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            z-index: 20;
            letter-spacing: 0.5px;
        }
        
        /* === TOMBOL AKSI SEJAJAR (UNIFIED ROW) === */
        .modal-action-row-unified { display: flex; gap: 10px; margin-top: 20px; align-items: stretch; }

        .btn-icon-sq {
            width: 48px; height: 48px; display: flex; align-items: center; justify-content: center;
            border-radius: 12px; border: 1px solid #dfe6e9; background: white; color: var(--dark);
            font-size: 1.2rem; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .btn-icon-sq:hover { transform: translateY(-2px); border-color: var(--primary); color: var(--primary); }
        .btn-icon-sq:active { transform: translateY(0); }

        .btn-cart-main {
            flex: 1; background: var(--primary); color: white; border: none; border-radius: 12px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center;
            justify-content: center; gap: 8px; box-shadow: 0 5px 15px rgba(0,184,148,0.3); transition: all 0.2s;
        }
        .btn-cart-main:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,184,148,0.4); }
        .btn-cart-main:active { transform: translateY(0); }
        .btn-cart-main:disabled { background: #b2bec3; cursor: not-allowed; box-shadow: none; opacity: 0.7; }

        #modal-name, #modal-breadcrumb { padding-right: 35px; }

        /* === END CSS TAMBAHAN === */

        /* === TOP BAR & BOTTOM BAR ANIMASI === */
        #top-bar-container { display: none; width: 100%; background-color: #008f7a; color: #ffffff; padding: 8px 0; overflow: hidden; white-space: nowrap; position: relative; z-index: 2000; font-size: 0.85rem; font-weight: 600; border-bottom: 1px solid rgba(0,0,0,0.1); }
        
        #bottom-bar-container { 
            display: none; 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            background-color: #2d3436; 
            color: #ffffff; 
            padding: 10px 0; 
            font-size: 0.85rem; 
            font-weight: 500; 
            
            /* REVISI PENTING: Z-INDEX LEBIH RENDAH DARI MODAL */
            z-index: 5000; 
            
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2); 
            backdrop-filter: blur(5px); 
            overflow: hidden; 
            white-space: nowrap; 
        }

        .teks-gerak { display: inline-block; padding-left: 100%; animation: jalan-kiri 25s linear infinite; }
        @keyframes jalan-kiri { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        #top-bar-container:hover .teks-gerak, #bottom-bar-container:hover .teks-gerak { animation-play-state: paused; }
        body.has-bottom-bar { padding-bottom: 45px !important; }

        /* BUTTONS GENERAL */
        .btn-med { border: none; border-radius: 50px; cursor: pointer; transition: 0.2s; font-family: inherit; font-weight: 600; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transform: translateY(0); display: inline-flex; align-items: center; justify-content: center; gap: 5px;}
        .btn-med:active { transform: translateY(2px); box-shadow: none; }

        /* FLOATING CHAT BUTTON (MAIN) */
        .btn-chat-float {
            position: fixed; bottom: 25px; right: 25px;
            width: 50px; height: 50px; background-color: var(--wa-color); color: white;
            border-radius: 50%; box-shadow: 0 5px 20px rgba(37, 211, 102, 0.4);
            display: flex; align-items: center; justify-content: center;
            z-index: 2900; cursor: pointer; transition: all 0.3s ease;
        }
        .btn-chat-float:hover { transform: translateY(-5px) scale(1.1); }
        @keyframes floatUp { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        body.has-bottom-bar .btn-chat-float { bottom: 60px; }

        /* NAVBAR */
        nav { background: white; padding: 15px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 15px rgba(0,0,0,0.03); border-bottom: 3px solid var(--primary); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo-area { display: flex; flex-direction: column; justify-content: center; align-items: flex-start; }
        .logo-text { font-size: 1.4rem; font-weight: 800; line-height: 1; color: var(--dark); text-transform: uppercase; letter-spacing: -0.5px; margin: 0; }
        .logo-text span { color: var(--primary); display: block; font-size: 1.1rem; font-weight: 600; letter-spacing: 2px; margin-top: -2px; }
        .nav-right { display: flex; gap: 20px; align-items: center; }
        .menu-link { text-decoration: none; color: #636e72; font-weight: 500; font-size: 0.95rem; transition: 0.3s; padding: 5px 0; border-bottom: 2px solid transparent; cursor: pointer; }
        .menu-link:hover, .menu-link.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 700; }
        .cart-menu { cursor: pointer; font-weight: 600; color: var(--secondary); display: flex; align-items: center; gap: 8px; background: #e3f2fd; padding: 8px 15px; border-radius: 30px; transition: 0.3s; }
        .cart-menu:hover, .cart-menu.active { background: var(--secondary); color: white; }
        .cart-badge { background: var(--promo-red); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; width: 100%; flex: 1; }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BANNER */
        .promo-banner { 
            background: linear-gradient(135deg, #00b894 0%, #0984e3 100%); 
            color: white; 
            padding: 40px 50px; 
            border-radius: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
            box-shadow: var(--shadow-soft); 
            position: relative; 
            overflow: hidden; 
        }
        .banner-content { flex: 1; z-index: 2; }
        .banner-logo-area { flex: 1; display: flex; justify-content: flex-end; z-index: 2; }
        @keyframes floatLogo { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .banner-logo-img { max-height: 220px; width: auto; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2)); animation: floatLogo 3s ease-in-out infinite; }
        .promo-banner h1 { font-size: 2.8rem; margin: 15px 0; font-weight: 800; line-height: 1.1; }
        .btn-shop-now { background: white; color: var(--primary); padding: 12px 35px; font-weight: 700; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* HOME TITLE ROW */
        .home-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .home-title { margin: 0; font-weight: 800; font-size: 1.2rem; white-space: nowrap; color: var(--dark); }
        
        /* UNIFIED SCROLL CONTAINER */
        .category-scroll-container { display: flex; align-items: stretch; overflow-x: auto; gap: 10px; padding: 10px 5px; -ms-overflow-style: none; scrollbar-width: none; margin-bottom: 15px; width: 100%; }
        .category-scroll-container::-webkit-scrollbar { display: none; }
        
        .cat-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; width: auto; min-width: 80px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; border-radius: 12px; padding: 10px 5px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .cat-btn.active { background: #e3f2fd; border-color: var(--secondary); transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .cat-icon { font-size: 1.8rem; margin-bottom: 5px; }
        .cat-label { font-size: 0.7rem; font-weight: 600; text-align: center; line-height: 1.2; color: var(--dark); max-width: 80px; }

        /* FILTER & GRID */
        .filter-container { background: white; padding: 20px; border-radius: 20px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .search-box input { width: 100%; padding: 12px 20px; border: 1px solid #dfe6e9; border-radius: 50px; font-size: 0.95rem; outline: none; background: #f8f9fa; font-family: inherit; margin-bottom: 15px; }
        .search-box input:focus { border-color: var(--primary); background: white; }
        .filter-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .filter-select { padding: 10px 15px; border-radius: 12px; border: 1px solid #dfe6e9; font-size: 0.8rem; flex: 1; min-width: 130px; outline: none; cursor: pointer; font-family: inherit; transition: 0.3s; }
        .filter-select:disabled { background-color: #f1f2f6; color: #b2bec3; cursor: not-allowed; border-color: #eee; }
        .sort-btn-group { display: flex; gap: 5px; }
        .btn-sort { background: white; border: 1px solid #dfe6e9; padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; color: #636e72; font-weight: 500; }
        .btn-sort:hover { background: #f1f2f6; }
        .btn-sort.active { background: var(--dark); color: white; border-color: var(--dark); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 1px solid #f1f2f6; transition: 0.2s; display: flex; flex-direction: column; cursor: pointer; position: relative; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 25px rgba(0,0,0,0.08); }

        /* BADGES */
        .badge-capsule { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 4px; color: white; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; z-index: 20; box-shadow: 0 4px 6px rgba(0,0,0,0.2); letter-spacing: 0.5px; }
        .bg-blue { background: linear-gradient(135deg, #0984e3, #74b9ff); }
        .bg-fire { background: linear-gradient(135deg, #d63031, #ff7675); }
        .bg-gold { background: linear-gradient(135deg, #f1c40f, #f39c12); color: #2d3436; }
        .bg-dark { background: #2d3436; }
        .badge-promo { position: absolute; top: 10px; right: 10px; background: var(--promo-red); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.75rem; z-index: 20; box-shadow: 0 4px 6px rgba(0,0,0,0.15); }

        .overlay-sold { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.6); z-index: 15; display: flex; align-items: center; justify-content: center; backdrop-filter: grayscale(100%); }
        .text-sold { background: rgba(0, 0, 0, 0.8); color: white; padding: 5px 20px; font-weight: 800; font-size: 1rem; border: 2px solid white; transform: rotate(-10deg); text-transform: uppercase; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        .card-img-wrapper { height: 160px; display: flex; align-items: center; justify-content: center; padding: 15px; border-bottom: 1px solid #f5f6fa; position: relative; }
        .card-img-real { max-width: 90%; max-height: 90%; object-fit: contain; }
        .card-body { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .card-breadcrumb { font-size: 0.7rem; color: #636e72; margin-bottom: 5px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-title { font-size: 0.95rem; font-weight: 600; color: var(--dark); margin: 0 0 10px 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 42px; }
        .price-final { color: var(--primary-dark); font-weight: 700; font-size: 1.1rem; }
        .unit-badge { background: #e3f2fd; color: var(--secondary); font-size: 0.7rem; padding: 2px 6px; border-radius: 6px; margin-left: 5px; vertical-align: middle; font-weight: 600; }
        .card-actions { display: flex; flex-direction: row; gap: 10px; margin-top: auto; align-items: center; }
        .btn-add-cart { flex: 1; background: var(--primary); color: white; font-size: 1.2rem; padding: 8px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-compare { width: 45px; height: 40px; background: white; border: 1px solid #dfe6e9; color: #b2bec3; border-radius: 12px; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; }
        .btn-compare.active { border-color: var(--secondary); color: var(--secondary); background: #e3f2fd; }
        .btn-compare:disabled { cursor: not-allowed; opacity: 0.5; background: #f1f2f6; }

        /* TOAST & MODALS */
        #toast { visibility: hidden; min-width: 300px; background: white; border-left: 5px solid var(--primary); color: var(--dark); border-radius: 8px; padding: 15px; position: fixed; z-index: 999999; left: 50%; bottom: 30px; transform: translateX(-50%) translateY(50px); box-shadow: 0 10px 40px rgba(0,0,0,0.15); font-weight: 500; opacity: 0; transition: all 0.4s; display: flex; align-items: center; gap: 10px; }
        #toast.show { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(0); }
        #toast.error { border-left-color: var(--promo-red); }
        #compare-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--dark); color: white; padding: 10px 25px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 3000; display: flex; align-items: center; gap: 15px; transition: 0.4s; }
        #compare-bar.show { transform: translateX(-50%) translateY(0); }
        
        /* FIX: Z-INDEX MODAL 99999 AGAR DI ATAS SEMUANYA */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 99999; 
            backdrop-filter: blur(3px); 
        }
        
        .modal-content { background: white; width: 90%; max-width: 600px; margin: 50px auto; border-radius: 20px; padding: 30px; position: relative; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.15); animation: popIn 0.3s; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- FINAL FIX: COMPACT & FLEXIBLE COMPARE MODAL (ALL SCREENS) --- */
        #compare-modal .cart-table thead { display: none; }
        #compare-modal .cart-table { width: 100%; border-collapse: collapse; }

        /* Style Baris (Horizontal Selalu) */
        #compare-tbody tr {
            display: flex;
            align-items: center; /* Foto & Tombol Center Vertikal */
            justify-content: space-between;
            border-bottom: 1px solid #f1f2f6;
            padding: 10px 0;
            gap: 15px;
            width: 100%;
        }

        #compare-tbody td {
            display: block;
            border: none;
            padding: 0;
        }

        /* 1. Foto (Kiri) - Tetap */
        #compare-tbody td:nth-child(1) { width: 60px; flex-shrink: 0; }
        #compare-tbody td:nth-child(1) img { width: 100%; border-radius: 8px; object-fit: contain; }

        /* 2. Info Lengkap (Tengah) - Flexible */
        #compare-tbody td:nth-child(2) { 
            flex: 1; 
            min-width: 0; /* Mencegah overflow */
            font-size: 0.85rem;
            align-self: flex-start; /* Teks mulai dari atas */
        }
        
        /* Judul Produk */
        .compare-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        /* Harga */
        .compare-price {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        /* REVISI: Deskripsi dengan Scroll */
        .compare-desc {
            font-size: 0.75rem;
            color: #636e72;
            line-height: 1.3;
            
            /* Fitur Scroll */
            max-height: 65px;      /* Batas tinggi (sekitar 3-4 baris) */
            overflow-y: auto;      /* Muncul scroll jika lebih */
            white-space: normal;   /* Teks turun baris */
            display: block;
            padding-right: 5px;    /* Jarak biar gak nempel scrollbar */
        }

        /* 3. Tombol Add (Kanan) - Tetap */
        #compare-tbody td:nth-child(3) { 
            width: 45px; 
            flex-shrink: 0; 
            text-align: right; 
        }
        #compare-tbody td:nth-child(3) button {
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            padding: 0;
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: var(--primary);
            color: white;
            box-shadow: 0 3px 8px rgba(0,184,148,0.2);
        }

        /* Adjust modal width on mobile */
        @media (max-width: 768px) {
            #compare-modal .modal-content {
                width: 95%;      
                padding: 15px;   
                margin: 40px auto;
            }
        }

        /* CART & FOOTER */
        .cart-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .cart-table th { text-align: left; padding: 10px; color: #b2bec3; font-size: 0.8rem; text-transform: uppercase; }
        .cart-table td { background: white; padding: 15px; border-bottom: 1px solid #eee; }
        .alert-ongkir { background: #e3f2fd; color: #0984e3; padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 10px; }
        .checkout-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #dfe6e9; font-size: 0.95rem; margin-bottom: 15px; outline: none; font-family: inherit; }
        .checkout-input:focus { border-color: var(--primary); }
        .radio-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .radio-opt { flex: 1; position: relative; }
        .radio-opt input { position: absolute; opacity: 0; cursor: pointer; }
        
        /* REVISI LABEL UNTUK SUPPORT LOGO */
        .radio-opt label { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; /* Jarak antara ikon dan teks */
            padding: 12px; 
            text-align: center; 
            background: #fff; 
            border: 1px solid #dfe6e9; 
            border-radius: 10px; 
            font-weight: 500; 
            cursor: pointer; 
            font-size: 0.9rem; 
        }
        
        .radio-opt input:checked + label { background: #e0f2f1; border-color: var(--primary); color: var(--primary-dark); font-weight: 600; }
        .btn-gps { width: 100%; padding: 12px; background: white; color: var(--secondary); border: 1px solid var(--secondary); border-radius: 10px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease; margin-bottom: 10px; font-family: inherit; font-size: 0.9rem; }
        .btn-gps:hover { background: #e3f2fd; }
        .btn-gps.success { background: #dff9fb; color: #00b894; border-color: #00b894; pointer-events: none; }
        
        footer { background-color: white; padding: 40px 20px; text-align: center; border-top: 1px solid #eee; margin-top: auto; width: 100%; font-family: 'Poppins', sans-serif; }
        .footer-copyright { font-size: 12px; color: #333; margin-bottom: 8px; font-weight: 400; } 
        .footer-credit { font-size: 20px; color: #2d3436; line-height: 1.2; }
        .credit-thin { font-weight: 300; color: #555; }
        .credit-green { font-weight: 500; color: #00b894; }
        .credit-red { font-weight: 500; color: #ff7675; }

        /* MAINTENANCE SCREEN */
        #maintenance-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 99999; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .maintenance-icon { font-size: 4rem; margin-bottom: 20px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-20px);} 60% {transform: translateY(-10px);} }

        /* STRUK CSS */
        .struk-container { font-family: 'Courier New', Courier, monospace; background: #fff; padding: 20px; border: 1px solid #ddd; max-width: 400px; margin: 0 auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .struk-header-row { display: flex; align-items: center; justify-content: center; gap: 15px; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 15px; }
        .struk-logo { width: 50px; height: auto; object-fit: contain; }
        .struk-title { text-align: center; padding: 0 5px; }
        .struk-title h3 { margin: 0; font-size: 1rem; line-height: 1.2; }
        .struk-title p { margin: 0; font-size: 0.7rem; }
        .struk-body { margin-bottom: 15px; }
        .struk-item { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; }
        .struk-total { border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-weight: bold; font-size: 1.1rem;}
        .struk-footer { text-align: center; font-size: 0.8rem; margin-top: 20px; color: #666; }
        .admin-ongkir-input { width: 100px; padding: 5px; font-family: inherit; border: 1px solid #ccc; border-radius: 5px; text-align: right; font-size: 0.9rem; }

        @media print {
            body * { visibility: hidden; }
            #struk-modal, #struk-modal * { visibility: visible; }
            #struk-modal { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; background: white; z-index: 99999; }
            .modal-content { box-shadow: none; border: none; margin: 0; width: 100%; max-width: 100%; }
            #struk-modal button { display: none !important; }
        }

        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .promo-banner { flex-direction: column-reverse; text-align: center; padding: 30px; }
            .banner-logo-area { justify-content: center; margin-bottom: 20px; }
            .banner-logo-img { max-height: 150px; }
            .nav-right { gap: 15px; font-size: 0.8rem; }
            .cart-table th:nth-child(2), .cart-table td:nth-child(2) { display: none; }
        }

        /* === TAMBAHAN FITUR FAQ (TANYA JAWAB) === */
        
        /* 1. Tombol Melayang (Posisi di atas Tombol WA) */
        .btn-faq-float {
            position: fixed; 
            bottom: 95px; /* Jarak dari bawah (supaya pas di atas tombol WA) */
            right: 25px;  /* Jarak dari kanan */
            width: 50px; 
            height: 50px; 
            background: white; 
            color: var(--secondary); /* Warna Biru */
            border-radius: 50%; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex; 
            align-items: center; 
            justify-content: center;
            z-index: 2900; 
            cursor: pointer; 
            font-size: 1.5rem; 
            border: 2px solid white;
            transition: all 0.3s ease;
        }
        
        .btn-faq-float:hover { 
            transform: scale(1.1); 
            color: var(--primary); 
            border-color: var(--primary);
        }

        /* Jika ada Bottom Bar (Info Berjalan), tombol naik sedikit */
        body.has-bottom-bar .btn-faq-float { bottom: 130px; }

        /* 2. Gaya Accordion (Buka-Tutup) di dalam Modal */
        details.faq-item {
            border: 1px solid #f1f2f6;
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 10px;
            background: #fff;
            transition: all 0.3s;
        }
        
        details.faq-item[open] {
            border-color: var(--primary);
            background: #e0f2f1; /* Hijau muda saat dibuka */
        }

        summary.faq-question {
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            list-style: none; /* Hilangkan panah default browser */
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--dark);
        }

        /* Hapus panah default di Chrome/Safari */
        summary.faq-question::-webkit-details-marker { display: none; }

        /* Ganti dengan ikon +/- Custom */
        summary.faq-question::after {
            content: '+';
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 800;
        }

        details.faq-item[open] summary.faq-question::after {
            content: '-';
            color: var(--promo-red);
        }

        .faq-answer {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #636e72;
            line-height: 1.6;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
        }
    </style>
</head>
<body>

    <div id="top-bar-container">
        <div id="top-bar-text" class="teks-gerak">
            Loading Info...
        </div>
    </div>

    <div id="maintenance-screen">
        <div class="maintenance-icon">üöß</div>
        <h2 style="color:var(--dark);">TOKO SEDANG TUTUP</h2>
        <p style="color:#636e72; max-width:400px; margin:0 auto; line-height:1.6;">Mohon maaf, kami sedang melakukan stok opname atau istirahat. Silakan kembali lagi nanti.</p>
        <div style="margin-top:20px; color:var(--primary); font-weight:600;">Toko Obat Bintan Jaya</div>
    </div>

    <div class="btn-faq-float" onclick="openFAQModal()" title="Bantuan / FAQ">
        ‚ùì
    </div>

    <div id="faq-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 500px;">
            <button onclick="closeModal('faq-modal')" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            
            <div style="text-align:center; margin-bottom:20px;">
                <div style="font-size:3rem; margin-bottom:5px;">üíÅüèª‚Äç‚ôÇÔ∏è</div>
                <h3 style="margin:0; color:var(--primary-dark);">Pertanyaan Umum</h3>
                <p style="font-size:0.85rem; color:#636e72;">Info seputar operasional Toko Obat Bintan Jaya</p>
            </div>

            <details class="faq-item">
                <summary class="faq-question">üè™ Toko buka jam berapa?</summary>
                <div class="faq-answer">
                    Kami buka setiap hari (Senin - Minggu)<br>
                    <b>Pukul 08.00 - 22.00 WIB.</b>
                </div>
            </details>

            <details class="faq-item">
                <summary class="faq-question">üõµ Apakah bisa Pesan Antar (Delivery)?</summary>
                <div class="faq-answer">
                    <b>Mohon maaf, saat ini kami TIDAK menyediakan kurir pengantaran toko.</b><br><br>
                    Kami hanya melayani sistem <b>Pick Up (Ambil Sendiri)</b>. Anda bisa memesan kurir online (Gojek/Maxim) secara mandiri untuk mengambil pesanan yang sudah siap di kasir.
                </div>
            </details>

            <details class="faq-item">
                <summary class="faq-question">üí∞ Cara pembayarannya bagaimana?</summary>
                <div class="faq-answer">
                    Ada 2 cara mudah:<br>
                    1. <b>Tunai (Cash):</b> Bayar saat ambil barang di kasir.<br>
                    2. <b>Transfer Bank:</b> Bayar saat pesanan selesai checkout di web (sebelum barang diambil).
                </div>
            </details>

            <details class="faq-item">
                <summary class="faq-question">‚úÖ Apakah obatnya Asli?</summary>
                <div class="faq-answer">
                    <b>100% Asli & Aman.</b><br>
                    Toko kami memiliki izin resmi dan diawasi langsung oleh Tenaga Teknis Kefarmasian, sesuai prinsip <b>F.A.S.T</b> (Fatonah, Amanah, Siddiq, Tabligh).
                </div>
            </details>

            <details class="faq-item">
                <summary class="faq-question">üìç Lokasi tokonya di mana?</summary>
                <div class="faq-answer">
                    Alamat: <b>Jl. Bintan No.29, Dumai Timur.</b><br><br>
                    <a href="https://goo.gl/maps/Yv6gG9qXz8x" target="_blank" class="btn-med" style="background:#0984e3; color:white; padding:8px 15px; font-size:0.8rem; text-decoration:none;">üó∫Ô∏è Buka Google Maps</a>
                </div>
            </details>

            <div style="margin-top:20px; text-align:center; font-size:0.8rem; background:#f8f9fa; padding:10px; border-radius:8px;">
                Masih butuh bantuan?<br>
                <a href="javascript:void(0)" onclick="closeModal('faq-modal'); openChatModal();" style="color:var(--wa-color); font-weight:700;">Chat Admin via WA &rarr;</a>
            </div>

        </div>
    </div>

    <div class="btn-chat-float" onclick="openChatModal()">
        üí¨
    </div>

    <div id="chat-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 400px;">
            <button onclick="closeModal('chat-modal')" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            <h3 style="margin-bottom:10px; text-align:center;">üí¨ Chat Bantuan</h3>
            <p style="text-align:center; color:#636e72; font-size:0.9rem; margin-bottom:20px;">
                Bingung pilih produk atau mau tanya-tanya dulu? Tanyakan langsung ke Admin.
            </p>
            <label style="font-weight:600; display:block; margin-bottom:5px;">Nama Anda</label>
            <input type="text" id="chat-name" class="checkout-input" placeholder="Nama...">
            
            <label style="font-weight:600; display:block; margin-bottom:5px;">Pertanyaan / Pesan</label>
            <textarea id="chat-msg" class="checkout-input" rows="4" placeholder="Tulis pertanyaan Anda disini..."></textarea>
            
            <button onclick="sendChat()" class="btn-med" style="width:100%; background:var(--wa-color); color:white; padding:12px;">KIRIM KE WA‚û°Ô∏è</button>
        </div>
    </div>

    <div id="struk-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 450px; background: #f8f9fa;">
            <button onclick="document.getElementById('struk-modal').style.display='none'; location.href='?'" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            <div id="struk-content"></div>
            <button class="btn-med" onclick="window.print()" style="width:100%; margin-top:20px; background:#2d3436; color:white;">üñ®Ô∏è CETAK STRUK</button>
        </div>
    </div>

    <div id="welcome-modal" class="modal" style="z-index: 9000;">
        <div class="modal-content" style="text-align: center; max-width: 400px;">
            <div style="font-size: 3.5rem; margin-bottom: 10px;">üëã</div>
            <h3 style="margin-bottom: 10px; color: var(--primary-dark);">Selamat Datang</h3>
            <p style="color:#636e72; margin-bottom:20px; font-size:0.9rem;">Silakan isi nama Anda untuk mulai berbelanja.</p>
            <input type="text" id="visitor-name" class="checkout-input" placeholder="Nama Anda..." style="text-align:center; font-weight:600;" oninput="this.value = this.value.replace(/[^a-zA-Z\s]/g, '')">
            <button class="btn-med" onclick="enterShop()" style="width:100%; background:var(--primary); color:white; padding:12px;">MASUK TOKO</button>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="logo-area">
                <div class="logo-text">TOKO OBAT</div>
                <div class="logo-text"><span>BINTAN JAYA</span></div>
            </div>
            <div class="nav-right">
                <a id="nav-home" class="menu-link active" onclick="showPage('home-page')">Beranda</a>
                <a id="nav-product" class="menu-link" onclick="showPage('product-page')">Produk</a>
                <div id="nav-cart" class="cart-menu" onclick="showPage('cart-page')">
                    üõí <span id="cart-count" class="cart-badge">0</span>
                </div>
                <button onclick="adminLogin()" class="btn-med" style="background:#2d3436; color:white; padding: 5px 12px; font-size:0.7rem;">ADMIN</button>
            </div>
        </div>
    </nav>

    <div id="toast">
        <span id="toast-icon" style="font-size:1.2rem;">‚úÖ</span> 
        <span id="toast-msg">Pesan Notifikasi</span>
    </div>

    <div id="compare-bar">
        <div style="font-weight:600;">‚öñÔ∏è Perbandingan (<span id="compare-count">0</span>/3)</div>
        <button class="btn-med" onclick="openCompareModal()" style="background:var(--primary); color:white; padding:5px 15px; font-size:0.8rem;">LIHAT</button>
    </div>

    <div id="home-page" class="container page active">
        <div class="promo-banner">
            <div class="banner-content">
                <span style="background:rgba(255,255,255,0.2); padding:5px 15px; border-radius:20px; font-size:0.8rem; font-weight:500;">KAMI ADA UNTUK KELUARGA üíóü´∂üèªü´Ç</span>
                <h1>Kesehatan Keluarga<br>Prioritas Kami</h1>
                <p style="opacity:0.9; margin-bottom:20px; font-size:0.9rem;">Produk lengkap, harga bersahabat, dan terpercaya.</p>
                <button onclick="showPage('product-page')" class="btn-med btn-shop-now">BELANJA SEKARANG</button>
            </div>
            <div class="banner-logo-area">
                <img src="logo.png" alt="Logo Toko Obat" class="banner-logo-img">
            </div>
        </div>

        <div id="home-cat-icons" class="category-scroll-container" style="margin-bottom: 25px;"></div>

        <div class="home-header-row" style="margin-bottom: 15px;">
            <h3 class="home-title">Highlight Produk Pilihan üéâüõçÔ∏è‚ú®</h3>
            <small onclick="showPage('product-page')" style="color:var(--primary); font-weight:600; cursor:pointer;">Lihat Semua &rarr;</small>
        </div>

        <div id="loading-container" style="text-align:center; padding: 40px;">
            <div id="loading-text" style="font-size:1rem; color:var(--primary); font-weight:600; margin-bottom:10px;">Menghubungkan ke Server...</div>
            <div style="width:60px; height:4px; background:#dfe6e9; margin:0 auto; border-radius:10px; overflow:hidden;">
                <div style="width:50%; height:100%; background:var(--primary); animation: loadBar 1s infinite alternate;"></div>
            </div>
        </div>
        <style>@keyframes loadBar { from{transform:translateX(-50%)} to{transform:translateX(50%)} }</style>

        <div id="promo-area" style="display: none;">
            <div id="promo-list" class="grid"></div>
        </div>
    </div>

    <div id="product-page" class="container page">
        <h3 style="margin-bottom:20px; font-weight:700;">üì¶ Katalog Produk</h3>
        <div class="filter-container">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Cari nama produknya..." onkeyup="filterProducts()">
            </div>
            <div id="product-cat-icons" class="category-scroll-container"></div>
            <div class="filter-row">
                <select id="filter-sub" class="filter-select" disabled onchange="changeSubCategory()">
                    <option value="">Sub Kategori</option>
                </select>
                <select id="filter-type" class="filter-select" disabled onchange="filterProducts()">
                    <option value="">Jenis Produk</option>
                </select>
                <div class="sort-btn-group">
                    <button id="sort-asc" class="btn-sort" onclick="sortProducts('asc')">üí∞ Harga ‚Üì</button>
                    <button id="sort-desc" class="btn-sort" onclick="sortProducts('desc')">üí∞ Harga ‚Üë</button>
                </div>
                <button class="btn-med" onclick="resetFilters()" style="background:#ff7675; color:white; padding:8px 20px; font-size:0.8rem; margin-left:auto;">RESET ‚úï</button>
            </div>
        </div>
        <div id="product-list" class="grid"></div>
        
        <div id="no-result" style="display:none; text-align:center; padding:60px 20px; color:#636e72;">
            <div style="font-size:4rem; margin-bottom:15px; animation: floatLogo 3s infinite;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <h3 style="color:var(--dark); margin-bottom:10px;">Yah, Produk Tidak Ditemukan...</h3>
            <p style="margin-bottom:25px; max-width:400px; margin-left:auto; margin-right:auto;">
                Ayo dipersilahkan minta ke admin untuk diadakan produk yang kamu butuhkan :D
            </p>
            <button class="btn-med" onclick="openRequestModal()" style="background:var(--wa-color); color:white; padding:12px 30px; box-shadow:0 10px 20px rgba(37, 211, 102, 0.2);">
                üôã‚Äç‚ôÇÔ∏è REQUEST PRODUK
            </button>
            <div style="margin-top:15px; font-size:0.8rem; color:#b2bec3; font-style:italic;">
                ‚ÑπÔ∏è Pengadaan tergantung distributor & ketersediaan. Admin akan menghubungi jika produk tersedia.
            </div>
        </div>
    </div>

    <div id="cart-page" class="container page">
        <h3 style="margin-bottom:20px; font-weight:700;">üõí Keranjang Belanja</h3>
        <div id="cart-empty" style="text-align:center; padding:60px; display:none;">
            <div style="font-size:3rem; margin-bottom:10px; opacity:0.3;">üõí</div>
            <h4 style="color:#636e72;">Keranjang masih kosong</h4>
            <button onclick="showPage('product-page')" class="btn-med" style="background:var(--primary); color:white; padding:10px 25px; margin-top:15px;">Mulai Belanja</button>
        </div>
        <div id="cart-filled" style="display:none;">
            <table class="cart-table">
                <thead><tr><th>PRODUK</th><th>HARGA</th><th>QTY</th><th>TOTAL</th><th></th></tr></thead>
                <tbody id="cart-table-body"></tbody>
            </table>
            <div class="alert-ongkir"><span style="font-size:1.2rem;">‚ÑπÔ∏è</span> <div><b>Informasi Pengiriman:</b><br>Toko kami tidak menyediakan jasa pengiriman langsung. Silakan ambil pesanan di lokasi atau gunakan layanan kurir ojol üõµüí®.</div></div>
            <div style="background:white; padding:25px; border-radius:15px; margin-top:20px; text-align:right; border:1px solid #eee;">
                <div style="color:#636e72; font-size:0.9rem;">Grand Total: <span id="cart-grand-total" style="font-weight:600; color:var(--dark);">Rp 0</span></div>
                <div style="color:#636e72; margin-bottom:10px; font-size:0.9rem; display:none;">Pembulatan: <span id="cart-rounding" style="font-weight:600; color:var(--dark);">Rp 0</span></div>
                <div style="font-size:1.4rem; font-weight:700; color:var(--primary-dark);">Total: <span id="cart-final-total">Rp 0</span></div>
                <button class="btn-med" onclick="openCheckoutModal()" style="width:auto; padding:12px 35px; margin-top:20px; background:var(--wa-color); color:white;">LANJUT PEMESANAN ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="product-modal" class="modal">
        <div class="modal-content">
            <button onclick="closeModal('product-modal')" style="position:absolute; right:20px; top:20px; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#b2bec3; z-index:100;">‚úï</button>
            
            <div style="display:flex; flex-wrap:wrap; gap:25px;">
                <div style="flex:1; min-width:200px;">
                    <div class="modal-img-container">
                        <div id="modal-badge-area"></div>
                        <img id="modal-img" src="" onerror="this.style.display='none'; document.getElementById('modal-placeholder').style.display='block';">
                        <div id="modal-placeholder" style="font-size:3rem; color:#dfe6e9; font-weight:700; display:none;">IMG</div>
                    </div>
                </div>

                <div style="flex:1.5; min-width:200px;">
                    <div id="modal-breadcrumb" style="font-size:0.8rem; color:var(--primary); font-weight:600; margin-bottom:8px;"></div>
                    <h2 id="modal-name" style="margin:0 0 15px 0; font-size:1.3rem;">Nama Produk</h2>
                    
                    <div id="modal-price-area" style="margin-bottom:20px;"></div>

                    <div style="background:#f1f2f6; padding:15px; border-radius:12px; font-size:0.9rem; color:#636e72; line-height:1.6; margin-bottom:15px;">
                        <div id="modal-desc"></div>
                        <div style="margin-top:10px; font-weight:600;">Stok Gudang: <span id="modal-stock" style="color:var(--primary);">Ada</span></div>
                    </div>

                    <div id="modal-variant-area" class="variant-container" style="display:none;">
                        <label class="variant-label">Pilih Varian / Rasa:</label>
                        <div id="variant-options-box" class="variant-options"></div>
                    </div>

                    <div class="modal-action-row-unified">
                        <button onclick="actionShareProduct()" class="btn-icon-sq" title="Bagikan">üîó</button>
                        <button onclick="actionAskProduct()" class="btn-icon-sq" title="Tanya Admin">üí¨</button>
                        <button id="modal-btn-add" class="btn-cart-main">
                            </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="modal">
        <div class="modal-content" style="max-width:500px;">
            <button onclick="closeModal('checkout-modal')" style="position:absolute; right:20px; top:15px; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#b2bec3;">‚úï</button>
            <h3 style="border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:20px;">üìù Konfirmasi Pesanan</h3>
            
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Nama Pemesan</label>
                <input type="text" id="cust-name" class="checkout-input">
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Metode Pengambilan</label>
                <div class="radio-box">
                    <div class="radio-opt">
                        <input type="radio" id="pick-self" name="pickup" value="Ambil Sendiri" checked onchange="togglePickup()">
                        <label for="pick-self">üôã‚Äç‚ôÇÔ∏è Ambil Sendiri</label>
                    </div>
                    <div class="radio-opt">
                        <input type="radio" id="pick-courier" name="pickup" value="Ambil Via Kurir" onchange="togglePickup()">
                        <label for="pick-courier">üõµ Ambil Via Kurir</label>
                    </div>
                </div>
            </div>

            <div id="pickup-details" style="margin-bottom:15px; background:#f8f9fa; padding:15px; border-radius:10px; border:1px dashed #b2bec3;">
                <label style="font-weight:600; font-size:0.85rem; display:block; margin-bottom:5px;">Nama Yang Mengambil Barang:</label>
                <input type="text" id="picker-name" class="checkout-input" placeholder="Contoh: Saya Sendiri / Anak Saya" style="margin-bottom:0;">
            </div>

            <div style="margin-bottom:20px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Metode Pembayaran</label>
                <div class="radio-box">
                    <div class="radio-opt"><input type="radio" id="pay-cash" name="payment" value="Cash / Tunai" checked><label for="pay-cash">üíµ Tunai (Di Toko)</label></div>
                    
                    <div class="radio-opt">
                        <input type="radio" id="pay-tf" name="payment" value="Transfer (BSI)">
                        <label for="pay-tf">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/a/a0/Bank_Syariah_Indonesia.svg" alt="BSI" style="height:18px;">
                            Transfer
                        </label>
                    </div>

                </div>
            </div>
            <button onclick="processCheckout()" class="btn-med" style="width:100%; background:var(--wa-color); color:white; padding:15px;">KIRIM PESAN (WA)</button>
        </div>
    </div>

    <div id="request-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 450px;">
            <button onclick="closeModal('request-modal')" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            <h3 style="margin-bottom:20px; text-align:center;">üìù Form Request Produk</h3>
            
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Nama Anda</label>
                <input type="text" id="req-name" class="checkout-input" placeholder="Nama Anda...">
            </div>
            
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Nama Produk</label>
                <input type="text" id="req-product" class="checkout-input" placeholder="Produk yang dicari...">
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Kategori Produk</label>
                <select id="req-category" class="checkout-input">
                    <option value="">-- Pilih Kategori --</option>
                </select>
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Untuk Siapa?</label>
                <div class="radio-box" style="margin-bottom:0;">
                    <div class="radio-opt">
                        <input type="radio" id="for-self" name="req-for" value="Diri Sendiri" checked>
                        <label for="for-self">üë§ Diri Sendiri</label>
                    </div>
                    <div class="radio-opt">
                        <input type="radio" id="for-family" name="req-for" value="Keluarga">
                        <label for="for-family">üë®‚Äçüë©‚Äçüëß Keluarga</label>
                    </div>
                </div>
            </div>

            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Jenis Kebutuhan?</label>
                <div class="radio-box" style="margin-bottom:0;">
                    <div class="radio-opt">
                        <input type="radio" id="need-sick" name="req-need" value="Sedang Sakit" checked>
                        <label for="need-sick">üöë Sedang Sakit</label>
                    </div>
                    <div class="radio-opt">
                        <input type="radio" id="need-stock" name="req-need" value="Stok Rutin">
                        <label for="need-stock">üîÑ Stok Rutin</label>
                    </div>
                    <div class="radio-opt">
                        <input type="radio" id="need-other" name="req-need" value="Lainnya">
                        <label for="need-other">‚ùì Lainnya</label>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Alasan Request</label>
                <textarea id="req-reason" class="checkout-input" rows="3" placeholder="Jelaskan kenapa minta diadakan..."></textarea>
            </div>
            
            <button onclick="sendRequest()" class="btn-med" style="width:100%; background:var(--wa-color); color:white; padding:12px;">KIRIM REQUEST (WA)</button>
        </div>
    </div>

    <div id="compare-modal" class="modal">
        <div class="modal-content" style="max-width:800px;">
            <button onclick="closeModal('compare-modal')" style="position:absolute; right:20px; top:15px; background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            <h3>‚öñÔ∏è Perbandingan Produk</h3>
            <div style="overflow-x:auto; margin-top:20px;"><table class="cart-table" style="width:100%;"><tbody id="compare-tbody"></tbody></table></div>
        </div>
    </div>
    
    <div id="login-modal" class="modal">
        <div class="modal-content" style="max-width:350px; text-align:center;">
            <button onclick="closeModal('login-modal')" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:1.2rem;">‚úï</button>
            <div id="admin-login-form">
                <h3>üîê Admin Login</h3>
                <p style="color:#636e72; font-size:0.8rem; margin-bottom:15px;">Masukkan Password untuk Akses Dashboard</p>
                <input type="password" id="admin-pass" class="checkout-input" placeholder="Password..." style="margin-bottom:15px; text-align:center;">
                <button onclick="checkAdmin()" class="btn-med" style="width:100%; background:var(--dark); color:white; padding:10px;">MASUK</button>
            </div>
            <div id="admin-dashboard" style="display:none;">
                <h3 style="color:var(--primary);">üëã Halo, Admin!</h3>
                <p style="margin-bottom:20px; font-size:0.9rem;">Silakan pilih menu operasional:</p>
                <button onclick="openAdminLink('master')" class="btn-med" style="width:100%; background:#0984e3; color:white; padding:12px; margin-bottom:10px; justify-content: flex-start;">üì¶ Master Data Produk (Stok)</button>
                <button onclick="openAdminLink('form')" class="btn-med" style="width:100%; background:#00b894; color:white; padding:12px; margin-bottom:10px; justify-content: flex-start;">üíª Mesin Kasir (Input Order)</button>
                <button onclick="openAdminLink('laporan')" class="btn-med" style="width:100%; background:#6c5ce7; color:white; padding:12px; margin-bottom:10px; justify-content: flex-start;">üìä Laporan Keuangan</button>
                <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
                <button onclick="location.reload()" class="btn-med" style="width:100%; background:#636e72; color:white; padding:10px;">LOGOUT</button>
            </div>
        </div>
    </div>

    <div id="review-modal" class="modal" style="z-index: 99999;">
        <div class="modal-content" style="text-align:center; max-width:400px; padding:40px 20px;">
            <div style="font-size:4rem; margin-bottom:10px; animation: bounce 2s infinite;">‚≠ê</div>
            <h3 style="color:var(--dark); margin-bottom:10px;">Pesanan Diterima!</h3>
            <p style="color:#636e72; font-size:0.9rem; line-height:1.6; margin-bottom:25px;">
                Terima kasih telah berbelanja. Sambil menunggu Admin membalas WA, maukah Anda bantu kami dengan memberi <b>Ulasan Bintang 5</b>?
            </p>
            <a href="https://search.google.com/local/writereview?placeid=ChIJmWxhV4ev0zERNcXROBPNApg" target="_blank" class="btn-med" onclick="closeModal('review-modal')" style="background:#f1c40f; color:#2d3436; width:100%; padding:15px; text-decoration:none; display:inline-flex;">
                ‚≠ê BERI ULASAN (G-MAPS)
            </a>
            <button onclick="closeModal('review-modal')" style="background:none; border:none; color:#b2bec3; margin-top:15px; cursor:pointer; font-size:0.85rem;">Nanti Saja</button>
        </div>
    </div>

    <div id="config-status" style="position:fixed; bottom:10px; left:10px; font-size:0.7rem; padding:5px 10px; background:rgba(0,0,0,0.7); color:white; border-radius:50px; z-index:9999;">
        ‚è≥ Memuat Config...
    </div>

    <div id="bottom-bar-container">
        <div id="bottom-bar-text" class="teks-gerak">
            Loading Info...
        </div>
    </div>

    <footer>
        <div class="footer-copyright">
            ¬© <span id="year">2026</span> Toko Obat Bintan Jaya. All Rights Reserved.
        </div>
        <div class="footer-credit">
            <span class="credit-thin">architected by</span> 
            <span class="credit-green">Internal Developer</span><br>
            <span class="credit-thin">&</span> 
            <span class="credit-red">Artificial Intelligence System</span>
        </div>
    </footer>

    <script>
        const BASE_URL_ONLINE = window.location.origin + window.location.pathname; 
        
        // --- LINK API PRODUK & CONFIG ---
        const API_PRODUCT_URL = "https://script.google.com/macros/s/AKfycbxNjJTTAZGCsSndLa5v20znpDL8gYyUgAX6-L-3bYdU5PHAWd3O5vUI2sk4qNXgEoZG7w/exec";
        const API_CONFIG_URL = "https://script.google.com/macros/s/AKfycbzB8eTk0dudSHdV18Rv59zBQMQpqtuPwFDnE_fibSz1f8REjQ-YimNwnltumQf0Bl2U-Q/exec";
        
        // --- ALAMAT TOKO (HARDCODED UNTUK ACUAN KURIR) ---
        const SHOP_ADDRESS = "Jl. Bintan No.29, Dumai Timur, Kota Dumai, Riau 28826"; 

        const CATEGORY_MAP = [
            { id: 'Non Herbal', icon: 'üíä', label: 'Non Herbal' }, 
            { id: 'Herbal', icon: 'üåø', label: 'Herbal' },
            { id: 'Bahan Medis Habis Pakai', icon: 'ü©π', label: 'Bahan Medis Habis Pakai' }, 
            { id: 'Alat Kesehatan (Alkes)', icon: 'ü©∫', label: 'Alat Kesehatan (Alkes)' },
            { id: 'Diagnostik In Vitro (DIV)', icon: 'ü§∞', label: 'Diagnostik In Vitro (DIV)' }, 
            { id: 'Personal Care', icon: 'üíÜüèª‚Äç‚ôÄÔ∏è', label: 'Personal Care' },
            { id: 'Baby Care', icon: 'üë∂üèª', label: 'Baby Care' }, 
            { id: 'General Merchandise', icon: 'üõçÔ∏è', label: 'General Merchandise' }
        ];

        let APP_CONFIG = { maintenance: "OFF", wa_order: "62895396166686", wa_request: "", wa_konsul: "", pass_admin: "000000", link_master: "", link_form: "", link_laporan: "", shop_open: "08:00", shop_close: "22:00" };
        let products = [];
        let cart = JSON.parse(localStorage.getItem('cart_v2')) || [];
        let compareList = [];
        let strukTotalBelanja = 0; 
        let activeCategory = ""; 
        let currentSort = null;
        let isShopClosed = false;
        
        // Variabel untuk modal saat ini
        let currentModalProductId = null;
        let currentSelectedVariant = null;

        function toTitleCase(str) { return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();}); }
        function cleanUnit(unit) { if (!unit) return ''; let clean = unit.replace(/\//g, '').trim(); return clean.charAt(0).toUpperCase() + clean.slice(1); }
        const formatRp = (num) => 'Rp ' + parseInt(num).toLocaleString('id-ID');

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            try { document.getElementById('toast-icon').innerText = isError ? "‚ö†Ô∏è" : "‚úÖ"; } catch(e){}
            if(isError) t.classList.add('error'); else t.classList.remove('error');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function getCustomRounding(amount) {
            const ribuan = Math.floor(amount / 1000) * 1000;
            const sisa = amount - ribuan;
            if (sisa >= 800) return ribuan + 1000;
            else if (sisa >= 300) return ribuan + 500;
            else return ribuan;
        }

        // --- REVISI: WINDOW ONLOAD (INSTANT LOAD) ---
        window.onload = function() {
            // 1. SETUP UI STATIS (LANGSUNG TAMPIL)
            document.getElementById('year').innerText = new Date().getFullYear();
            renderProductPageIcons(); 
            renderHomePageIcons();
            updateCartBadge();

            // 2. LOGIKA POPUP BUKU TAMU (PRIORITAS UTAMA)
            // Cek apakah user sudah pernah isi nama
            let visitor = null;
            try { visitor = sessionStorage.getItem('visitorName'); } catch(e) {}

            if(!visitor) { 
                // Jika belum ada nama, LANGSUNG munculkan popup
                document.getElementById('welcome-modal').style.display = 'block'; 
            } else { 
                // Jika sudah ada, isi form checkout
                try { document.getElementById('cust-name').value = visitor; } catch(e){} 
            }
            
            // 3. HANDLER UNTUK TOMBOL BACK (BROWSER)
            window.onpopstate = function(event) {
                // Cek apakah ada parameter produk di URL
                const urlParams = new URLSearchParams(window.location.search);
                const prodLink = urlParams.get('product');

                // Jika TIDAK ada parameter product (kembali ke root), tutup modal
                if (!prodLink) {
                    closeModal('product-modal');
                } else {
                    // Jika ADA parameter (misal user forward), buka modal lagi
                    // (Opsional, tapi biasanya browser handle ini)
                    const prodId = parseInt(prodLink);
                    if(products.length > 0) openProductModal(prodId);
                }
            };

            // 4. JALANKAN DOWNLOAD DATA DI BACKGROUND
            runBackgroundProcess();
        };

        // Fungsi baru untuk loading data di background
        async function runBackgroundProcess() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('struk')) { 
                showStruk(urlParams.get('struk')); 
                document.getElementById('welcome-modal').style.display = 'none'; 
                return; 
            } 

            await loadAppConfig();
            
            if(String(APP_CONFIG.maintenance).toUpperCase().trim() === 'ON') {
                 document.getElementById('welcome-modal').style.display = 'none';
                 document.getElementById('maintenance-screen').style.display = 'flex';
                 document.getElementById('loading-container').style.display = 'none';
                 return; 
            }

            await loadProducts();
            
            // Cek Deep Link (setelah produk siap)
            const prodLink = urlParams.get('product');
            if(prodLink) {
                const prodId = parseInt(prodLink);
                const exist = products.find(p => p.id === prodId);
                if(exist) {
                    setTimeout(() => openProductModal(prodId), 500);
                }
            }
        }

        async function loadAppConfig() {
            const statusEl = document.getElementById('config-status');
            try {
                const res = await fetch(API_CONFIG_URL + "?nocache=" + new Date().getTime());
                if (!res.ok) throw new Error("Gagal fetch API");
                const data = await res.json(); 
                
                APP_CONFIG = { 
                    maintenance: data.Maintenance || "OFF", 
                    wa_order: data.WA_Order || "62895396166686", 
                    wa_request: data.WA_Request || "", 
                    wa_konsul: data.WA_Konsul || data.WA_Order, 
                    pass_admin: String(data.Pass_Admin || "000000"), 
                    link_master: data.Link_Master || "", 
                    link_form: data.Link_Form || "", 
                    link_laporan: data.Link_Laporan || "",
                    shop_open: data.Jam_Buka || "08:00",
                    shop_close: data.Jam_Tutup || "22:00"
                };

                if (data.TopBar_Info) {
                    document.getElementById('top-bar-container').style.display = 'block';
                    document.getElementById('top-bar-text').innerHTML = data.TopBar_Info;
                }
                if (data.BottomBar_Info) {
                    document.getElementById('bottom-bar-container').style.display = 'block';
                    document.getElementById('bottom-bar-text').innerHTML = data.BottomBar_Info;
                    document.body.classList.add('has-bottom-bar');
                }

                statusEl.innerText = "üü¢ Config OK"; 
                statusEl.style.background = "rgba(0,184,148,0.8)"; 
                setTimeout(() => statusEl.style.display = 'none', 3000);
                checkShopStatus();

            } catch (e) { 
                console.error(e);
                statusEl.innerText = "üî¥ API Config Error"; 
                statusEl.style.background = "rgba(214,48,49,0.8)"; 
            }
        }

        function checkShopStatus() {
            const now = new Date();
            const currentHour = now.getHours();
            const openH = parseInt(APP_CONFIG.shop_open.split(':')[0]);
            const closeH = parseInt(APP_CONFIG.shop_close.split(':')[0]);
            
            if (currentHour < openH || currentHour >= closeH) {
                isShopClosed = true;
                const topBar = document.getElementById('top-bar-text');
                const topCont = document.getElementById('top-bar-container');
                if(topBar) topBar.innerHTML = `‚õî MAAF TOKO SUDAH TUTUP. BUKA KEMBALI JAM ${APP_CONFIG.shop_open} WIB ‚õî`;
                if(topCont) { topCont.style.backgroundColor = "#d63031"; topCont.style.display = "block"; }
                initShop(); 
            } else {
                isShopClosed = false;
            }
        }

        async function loadProducts() {
            const loading = document.getElementById('loading-container');
            const loadingText = document.getElementById('loading-text');
            loadingText.innerText = "Mengambil data produk..."; loading.style.display = 'block'; 
            document.getElementById('promo-area').style.display = 'none';
            try {
                const res = await fetch(API_PRODUCT_URL);
                if (!res.ok) throw new Error("Gagal mengambil data API");
                const rows = await res.json(); 
                if(rows.error) throw new Error(rows.error);
                const dataRows = rows.slice(1);
                // REVISI: MENAMBAH KOLOM KE-11 (INDEX 11) UNTUK VARIAN
                const newProducts = dataRows.map((cols, idx) => {
                    if(!cols || cols.length < 2) return null;
                    return { 
                        id: idx + 1, name: cols[0], category: cols[1], subCategory: cols[2], type: cols[3], 
                        price: typeof cols[4] === 'number' ? cols[4] : (parseInt(String(cols[4]).replace(/[^\d]/g, '')) || 0), 
                        discount: parseInt(cols[5]) || 0, stock: cols[6] ? String(cols[6]) : 'Ada', 
                        image: cols[7], desc: cols[8], unit: cleanUnit(cols[9]), label: cols[10] ? String(cols[10]).trim() : '',
                        variantRaw: cols[11] ? String(cols[11]) : '' // DATA VARIAN KOLOM L
                    };
                }).filter(p => p);
                if(newProducts.length > 0) { products = newProducts; initShop(); loading.style.display = 'none'; document.getElementById('promo-area').style.display = 'block'; } 
                else { loading.innerHTML = `<div style="color:red; font-weight:600;">‚ö†Ô∏è Data Kosong.</div>`; }
            } catch(e) { console.error(e); loading.innerHTML = `<div style="color:red; font-weight:600;">‚ö†Ô∏è Terjadi Kesalahan.<br><small>${e.message}</small></div>`; }
        }

        function initShop() { renderProducts(products); renderHomeList(); } 
        function renderHomeList() { const homeItems = products.filter(p => p.discount > 0 || (p.label && p.label !== '')); document.getElementById('promo-list').innerHTML = homeItems.map(p => createCardHTML(p)).join(''); }
        
        function createCardHTML(p) {
            const finalPrice = p.price - (p.price * (p.discount/100));
            const isHabis = !p.stock.toLowerCase().includes('ada') && p.stock != '0' && p.stock != ''; 
            
            let labelBadge = '';
            if(p.label) {
                let badgeColor = 'bg-dark';
                const txt = p.label.toLowerCase();
                if(txt.includes('new') || txt.includes('baru')) badgeColor = 'bg-blue';
                else if(txt.includes('hot')) badgeColor = 'bg-fire';
                else if(txt.includes('best')) badgeColor = 'bg-gold';
                labelBadge = `<div class="badge-capsule ${badgeColor}">${p.label}</div>`;
            }
            const discountBadge = p.discount > 0 ? `<div class="badge-promo">-${p.discount}%</div>` : '';
            const soldOverlay = isHabis ? `<div class="overlay-sold"><div class="text-sold">SOLD OUT</div></div>` : '';
            const breadcrumb = toTitleCase(`${p.category} > ${p.subCategory}`);
            
            // --- REVISI DISINI: UBAH TEKS JADI IKON KERANJANG ---
            // Kode ikon: üõí (0x1F6D2)
            let btnText = String.fromCodePoint(0x1F6D2) + ' +'; // Ikon Keranjang + Tanda Plus
            
            let btnStyle = '';
            let btnDisabled = '';
            let btnCompareAttr = '';
            
            if (isHabis) {
                btnCompareAttr = 'disabled style="opacity:0.5; cursor:not-allowed;"'; 
            } else {
                btnCompareAttr = `onclick="toggleCompare(${p.id}, this); event.stopPropagation()"`;
            }

            if (isShopClosed) {
                btnText = 'TUTUP'; 
                btnStyle = 'background:#b2bec3; cursor:not-allowed; font-size:0.8rem;';
                btnDisabled = 'disabled';
            } else if (isHabis) { 
                btnText = 'HABIS';
                btnStyle = 'background:#b2bec3; cursor:not-allowed; font-size:0.8rem;';
                btnDisabled = 'disabled';
            }

            return `
            <div class="card" onclick="openProductModal(${p.id})">
                ${labelBadge}${discountBadge}
                <div class="card-img-wrapper">${soldOverlay}${p.image && p.image.length > 5 ? `<img src="${p.image}" class="card-img-real" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">` : ''}<div style="font-size:2.5rem; color:#dfe6e9; font-weight:700; display:${p.image && p.image.length > 5 ? 'none':'block'}">${p.name.substring(0,2).toUpperCase()}</div></div>
                <div class="card-body">
                    <div class="card-breadcrumb">${breadcrumb}</div>
                    <div class="card-title">${p.name}</div>
                    <div class="price-group">${p.discount > 0 ? `<s style="color:#b2bec3; font-size:0.8rem;">${formatRp(p.price)}</s><br>` : ''}<span class="price-final" style="${isHabis ? 'color:#b2bec3':''}">${formatRp(finalPrice)}</span><span class="unit-badge">/${p.unit}</span></div>
                    <div class="card-actions">
                        <button class="btn-compare" ${btnCompareAttr}>${String.fromCodePoint(0x2696)}</button>
                        <button class="btn-med btn-add-cart" onclick="addToCart(${p.id}); event.stopPropagation()" ${btnDisabled} style="${btnStyle}">${btnText}</button>
                    </div>
                </div>
            </div>`;
        }

        function renderProductPageIcons() { const prodContainer = document.getElementById('product-cat-icons'); if(!prodContainer) return; const html = CATEGORY_MAP.map(cat => `<div class="cat-btn" onclick="selectCategory('${cat.id}')"><span class="cat-icon">${cat.icon}</span><span class="cat-label">${cat.label}</span></div>`).join(''); prodContainer.innerHTML = html; }
        
        function renderHomePageIcons() { 
            const homeContainer = document.getElementById('home-cat-icons'); 
            if(!homeContainer) return; 
            const html = CATEGORY_MAP.map(cat => `
                <div class="cat-btn" onclick="clickHomeCategory('${cat.id}')" style="min-width: 75px; background:white;">
                    <span class="cat-icon" style="font-size:1.5rem;">${cat.icon}</span>
                    <span class="cat-label" style="font-size:0.65rem;">${cat.label}</span>
                </div>
            `).join(''); 
            
            homeContainer.innerHTML = html; 
        }

        function clickHomeCategory(catId) { showPage('product-page'); selectCategory(catId); }
        function selectCategory(catId) { activeCategory = catId; document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active')); document.querySelectorAll('.cat-btn').forEach(btn => { if(btn.querySelector('.cat-label').innerText === catId || btn.querySelector('.cat-label').innerText === CATEGORY_MAP.find(c=>c.id===catId)?.label) btn.classList.add('active'); }); const subSel = document.getElementById('filter-sub'); const typeSel = document.getElementById('filter-type'); subSel.innerHTML = '<option value="">Sub Kategori</option>'; typeSel.innerHTML = '<option value="">Jenis Produk</option>'; typeSel.disabled = true; if(activeCategory) { const subCats = [...new Set(products.filter(p => p.category === activeCategory).map(p => p.subCategory))].filter(Boolean).sort(); if(subCats.length > 0) { subSel.disabled = false; subCats.forEach(s => subSel.innerHTML += `<option value="${s}">${s}</option>`); } else { subSel.disabled = true; } } else { subSel.disabled = true; } filterProducts(); }
        function changeSubCategory() { const sub = document.getElementById('filter-sub').value; const typeSel = document.getElementById('filter-type'); typeSel.innerHTML = '<option value="">Jenis Produk</option>'; if(sub && activeCategory) { const types = [...new Set(products.filter(p => p.category === activeCategory && p.subCategory === sub).map(p => p.type))].filter(Boolean).sort(); if(types.length > 0) { typeSel.disabled = false; types.forEach(t => typeSel.innerHTML += `<option value="${t}">${t}</option>`); } else { typeSel.disabled = true; } } else { typeSel.disabled = true; } filterProducts(); }
        function filterProducts() { const q = document.getElementById('search-input').value.toLowerCase(); const cat = activeCategory; const sub = document.getElementById('filter-sub').value; const type = document.getElementById('filter-type').value; let filtered = products.filter(p => (cat ? p.category === cat : true) && (sub ? p.subCategory === sub : true) && (type ? p.type === type : true) && (p.name.toLowerCase().includes(q) || p.type.toLowerCase().includes(q))); if(currentSort === 'asc') { filtered.sort((a, b) => { const priceA = a.price - (a.price * (a.discount/100)); const priceB = b.price - (b.price * (b.discount/100)); return priceA - priceB; }); } else if(currentSort === 'desc') { filtered.sort((a, b) => { const priceA = a.price - (a.price * (a.discount/100)); const priceB = b.price - (b.price * (b.discount/100)); return priceB - priceA; }); } renderProducts(filtered); }
        function sortProducts(order) { currentSort = order; document.querySelectorAll('.btn-sort').forEach(b => b.classList.remove('active')); if(order === 'asc') document.getElementById('sort-asc').classList.add('active'); if(order === 'desc') document.getElementById('sort-desc').classList.add('active'); filterProducts(); }
        function resetFilters() { document.getElementById('search-input').value=''; activeCategory = ""; currentSort = null; document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active')); document.querySelectorAll('.btn-sort').forEach(b => b.classList.remove('active')); document.getElementById('filter-sub').innerHTML='<option value="">Sub Kategori</option>'; document.getElementById('filter-sub').disabled=true; document.getElementById('filter-type').innerHTML='<option value="">Jenis Produk</option>'; document.getElementById('filter-type').disabled=true; renderProducts(products); }
        function renderProducts(list) { document.getElementById('product-list').innerHTML = list.map(p => createCardHTML(p)).join(''); document.getElementById('no-result').style.display = list.length ? 'none' : 'block'; }
        
        // --- ADD TO CART REVISI: SUPPORT VARIAN ---
        function addToCart(id, forcedVariantName = null) { 
            if(isShopClosed) return showToast("Maaf, Toko Sedang Tutup", true);
            
            const p = products.find(x => x.id === id);
            
            // LOGIKA VARIAN: Kalau dipanggil dari Modal dan ada varian yang dipilih
            let variantSuffix = "";
            let itemKey = id;

            // Jika dipanggil dari Modal (forcedVariantName ada isinya)
            if(forcedVariantName) {
                variantSuffix = ` - Varian: ${forcedVariantName}`;
                itemKey = id + "_VAR_" + forcedVariantName; // ID Unik di keranjang
            } else {
                // Kalau dipanggil dari luar (tombol card depan), cek apakah produk punya varian
                if(p.variantRaw && p.variantRaw.length > 2) {
                    // Kalau punya varian, WAJIB BUKA MODAL dulu
                    openProductModal(id);
                    showToast("Silakan pilih varian dulu", true);
                    return; 
                }
            }

            const exist = cart.find(x => x.key === itemKey); 
            
            if(exist) {
                exist.qty++; 
            } else {
                cart.push({...p, id: id, key: itemKey, name: p.name + variantSuffix, qty:1});
            }
            
            saveCart(); 
            showToast("Berhasil masuk keranjang"); 
        }
        
        function saveCart() { localStorage.setItem('cart_v2', JSON.stringify(cart)); updateCartBadge(); }
        function updateCartBadge() { document.getElementById('cart-count').innerText = cart.reduce((a,b) => a + b.qty, 0); }
        
        function renderCart() { 
            const tbody = document.getElementById('cart-table-body'); 
            let total = 0; 
            if(cart.length === 0) { 
                document.getElementById('cart-empty').style.display='block'; 
                document.getElementById('cart-filled').style.display='none'; 
                return; 
            } 
            document.getElementById('cart-empty').style.display='none'; 
            document.getElementById('cart-filled').style.display='block'; 
            
            tbody.innerHTML = cart.map((item, idx) => { 
                const price = item.price - (item.price * (item.discount/100)); 
                total += price * item.qty; 
                return `<tr><td><div style="font-weight:600;">${item.name}</div><div style="font-size:0.75rem; color:#b2bec3;">${item.type}</div></td><td>${formatRp(price)} <span style="font-size:0.75rem; color:#636e72;">/${item.unit}</span></td><td><div style="display:flex; align-items:center; gap:5px;"><button onclick="updateQty(${idx}, -1)" style="width:25px; border:1px solid #ddd; background:white;">-</button><span>${item.qty}</span><button onclick="updateQty(${idx}, 1)" style="width:25px; border:1px solid #ddd; background:white;">+</button></div></td><td style="font-weight:600;">${formatRp(price * item.qty)}</td><td><button onclick="removeFromCart(${idx})" style="color:#ff7675; border:none; background:none; cursor:pointer;">${String.fromCodePoint(0x2715)}</button></td></tr>`; 
            }).join(''); 
            
            document.getElementById('cart-grand-total').innerText = formatRp(total); 
            document.getElementById('cart-rounding').innerText = "Rp 0"; 
            document.getElementById('cart-final-total').innerText = formatRp(total); 
        }

        function updateQty(idx, val) { cart[idx].qty += val; if(cart[idx].qty < 1) cart.splice(idx, 1); saveCart(); renderCart(); }
        function removeFromCart(idx) { cart.splice(idx, 1); saveCart(); renderCart(); }
        function toggleCompare(id, btn) { if(compareList.includes(id)) { compareList = compareList.filter(x => x !== id); btn.classList.remove('active'); } else { if(compareList.length >= 3) return showToast("Maks 3 produk", true); compareList.push(id); btn.classList.add('active'); } const bar = document.getElementById('compare-bar'); document.getElementById('compare-count').innerText = compareList.length; if(compareList.length > 0) bar.classList.add('show'); else bar.classList.remove('show'); }
        function openCompareModal() { document.getElementById('compare-tbody').innerHTML = compareList.map(id => { const p = products.find(x => x.id === id); const price = p.price - (p.price * (p.discount/100)); return `<tr><td><img src="${p.image}" style="width:50px;" onerror="this.style.display='none'"></td><td><div class="compare-name">${p.name}</div><div class="compare-price">${formatRp(price)}/${p.unit}</div><div class="compare-desc">${p.desc}</div></td><td><button class="btn-med" onclick="addToCart(${p.id})" style="background:var(--primary); color:white; padding:5px; font-size:0.7rem;">+ ${String.fromCodePoint(0x1F6D2)}</button></td></tr>`; }).join(''); document.getElementById('compare-modal').style.display='block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; if(id === 'compare-modal') { compareList = []; document.getElementById('compare-bar').classList.remove('show'); document.querySelectorAll('.btn-compare').forEach(b => b.classList.remove('active')); } }
        
        // --- REVISI: MUNCULKAN KEMBALI TOMBOL CHAT SAAT TUTUP ---
        function closeModal(id) { 
            document.getElementById(id).style.display = 'none'; 
            
            // FIX BUG: Reset input chat jika modal chat ditutup
            if(id === 'chat-modal') {
                 document.getElementById('chat-msg').value = '';
            }

            if(id === 'compare-modal') { 
                compareList = []; 
                document.getElementById('compare-bar').classList.remove('show'); 
                document.querySelectorAll('.btn-compare').forEach(b => b.classList.remove('active')); 
            }

            // Jika yang ditutup adalah Modal Produk -> Munculkan lagi tombol Chat Utama
            if(id === 'product-modal') {
                const mainChatBtn = document.querySelector('.btn-chat-float');
                if(mainChatBtn) mainChatBtn.style.display = 'flex';

                // --- REVISI URL: HAPUS QUERY PARAM SAAT TUTUP ---
                // Bersihkan URL jadi bersih kembali (tanpa ?product=...)
                const cleanURL = window.location.pathname; // Hanya ambil path utama (/)
                window.history.pushState({ path: cleanURL }, '', cleanURL);
            }
        }

        // --- REVISI LOGIKA POPUP: AUTO-HIDE CHAT BUTTON ---
        function openProductModal(id) { 
            const p = products.find(x => x.id === id); 
            if (!p) return;
            currentModalProductId = id;
            currentSelectedVariant = null; 

            // --- REVISI: SEMBUNYIKAN TOMBOL CHAT UTAMA ---
            const mainChatBtn = document.querySelector('.btn-chat-float');
            if(mainChatBtn) mainChatBtn.style.display = 'none';

            // --- REVISI URL: UPDATE URL SAAT BUKA PRODUK ---
            // Supaya bisa di-refresh dan dishare langsung dari address bar
            const newUrl = '?product=' + id;
            window.history.pushState({path: newUrl}, '', newUrl);

            // Cek Stok
            const isHabis = !p.stock.toLowerCase().includes('ada') && p.stock != '0' && p.stock != '';
            if (isHabis) { return showToast("Maaf, Produk ini sedang Kosong/Sold Out", true); }

            // 1. ISI DATA UMUM
            const price = p.price - (p.price * (p.discount/100)); 
            document.getElementById('modal-name').innerText = p.name; 
            document.getElementById('modal-breadcrumb').innerText = toTitleCase(`${p.category} > ${p.subCategory} > ${p.type}`); 
            document.getElementById('modal-desc').innerText = p.desc || "Tidak ada deskripsi."; 
            document.getElementById('modal-stock').innerText = p.stock; 

            // 2. IMAGE HANDLING
            const img = document.getElementById('modal-img'); 
            const ph = document.getElementById('modal-placeholder'); 
            if(p.image && p.image.length > 5) { img.src = p.image; img.style.display = 'block'; ph.style.display = 'none'; } 
            else { img.style.display = 'none'; ph.style.display = 'block'; ph.innerText = p.name.substring(0,2).toUpperCase(); } 

            // 3. INJECT BADGES
            const badgeArea = document.getElementById('modal-badge-area');
            badgeArea.innerHTML = ''; 
            
            if(p.label) {
                let badgeColor = 'bg-dark';
                const txt = p.label.toLowerCase();
                if(txt.includes('new') || txt.includes('baru')) badgeColor = 'bg-blue';
                else if(txt.includes('hot')) badgeColor = 'bg-fire';
                else if(txt.includes('best')) badgeColor = 'bg-gold';
                badgeArea.innerHTML += `<div class="modal-badge-mini ${badgeColor}">${p.label}</div>`;
            }

            // 4. INJECT HARGA CORET
            const priceArea = document.getElementById('modal-price-area');
            if(p.discount > 0) {
                priceArea.innerHTML = `
                    <s style="color:#b2bec3; font-size:1rem;">${formatRp(p.price)}</s><br>
                    <span style="font-size:1.8rem; font-weight:700; color:var(--primary-dark);">${formatRp(price)}</span> 
                    <span style="font-size:0.9rem; color:#636e72; font-weight:400;">/${p.unit}</span>
                `;
            } else {
                priceArea.innerHTML = `
                    <span style="font-size:1.8rem; font-weight:700; color:var(--primary-dark);">${formatRp(price)}</span> 
                    <span style="font-size:0.9rem; color:#636e72; font-weight:400;">/${p.unit}</span>
                `;
            }

            // 5. RENDER VARIAN & TOMBOL UTAMA
            const variantArea = document.getElementById('modal-variant-area');
            const variantBox = document.getElementById('variant-options-box');
            const btnAdd = document.getElementById('modal-btn-add'); // Tombol Keranjang
            variantBox.innerHTML = '';
            
            // Default Style (Icon Cart + Plus)
            btnAdd.innerHTML = String.fromCodePoint(0x1F6D2) + " +"; 
            
            if(p.variantRaw && p.variantRaw.length > 2) {
                variantArea.style.display = 'block';
                btnAdd.disabled = true;
                btnAdd.style.background = "#b2bec3";
                btnAdd.onclick = null;

                const listVar = p.variantRaw.split(','); 
                listVar.forEach(v => {
                    const parts = v.split('='); 
                    if(parts.length === 2) {
                        const vName = parts[0].trim();
                        const vStatus = parts[1].trim().toLowerCase(); 
                        const isAvailable = (vStatus === 'ada' || vStatus === 'ready');
                        
                        const btn = document.createElement('div');
                        btn.className = 'var-btn';
                        if(!isAvailable) {
                            btn.className += ' disabled';
                            btn.innerText = vName + " (Habis)";
                        } else {
                            btn.innerText = vName;
                            btn.onclick = function() {
                                document.querySelectorAll('.var-btn').forEach(b => b.classList.remove('active'));
                                btn.classList.add('active');
                                currentSelectedVariant = vName;
                                if(!isShopClosed) {
                                    btnAdd.disabled = false;
                                    btnAdd.style.background = "var(--primary)";
                                    btnAdd.onclick = () => { addToCart(p.id, currentSelectedVariant); closeModal('product-modal'); };
                                }
                            };
                        }
                        variantBox.appendChild(btn);
                    }
                });

            } else {
                variantArea.style.display = 'none';
                if(isShopClosed) {
                    btnAdd.innerHTML = "TUTUP";
                    btnAdd.disabled = true;
                    btnAdd.style.background = "#b2bec3";
                } else {
                    btnAdd.disabled = false;
                    btnAdd.style.background = "var(--primary)";
                    btnAdd.onclick = () => { addToCart(p.id, null); closeModal('product-modal'); };
                }
            }
            
            document.getElementById('product-modal').style.display = 'block'; 
        }

        function actionShareProduct() {
            if(!currentModalProductId) return;
            // Generate link: website.com/?product=123
            const link = window.location.origin + window.location.pathname + "?product=" + currentModalProductId;
            
            // Buka WA
            const msg = `Eh liat deh, produk ini bagus lho: \n${link}`;
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function actionAskProduct() {
            if(!currentModalProductId) return;
            const p = products.find(x => x.id === currentModalProductId);
            
            // Tutup modal produk, buka modal chat
            closeModal('product-modal');
            
            // Pre-fill pesan di modal chat
            document.getElementById('chat-msg').value = `Saya mau tanya detail tentang produk "${p.name}" ini...`;
            openChatModal();
        }

        function openCheckoutModal() { 
            if(isShopClosed) return showToast("‚ö†Ô∏è Toko Tutup. Silakan kembali besok.", true);
            if(cart.length === 0) return showToast("Keranjang kosong!", true); 
            document.getElementById('checkout-modal').style.display='block'; 
        }
        
        function togglePickup() {
            const val = document.querySelector('input[name="pickup"]:checked').value;
            const container = document.getElementById('pickup-details');
            if (val === 'Ambil Sendiri') {
                container.innerHTML = `
                    <label style="font-weight:600; font-size:0.85rem; display:block; margin-bottom:5px;">Nama Yang Mengambil Barang:</label>
                    <input type="text" id="picker-name" class="checkout-input" placeholder="Contoh: Saya Sendiri / Anak Saya" style="margin-bottom:0;">
                `;
            } else {
                container.innerHTML = `
                    <div style="color:var(--promo-red); font-weight:600; text-align:center;">
                        ‚ö†Ô∏è PERHATIAN<br>
                        <span style="font-weight:400; font-size:0.9rem; color:#636e72;">Kurir dipesan & dibayar langsung oleh Pembeli.<br>Toko hanya menyerahkan barang.</span>
                    </div>
                `;
            }
        }

        function processCheckout() {
            const name = document.getElementById('cust-name').value;
            const pickupMethod = document.querySelector('input[name="pickup"]:checked').value;
            const pay = document.querySelector('input[name="payment"]:checked').value;
            
            if(!name) return showToast("Isi Nama Pemesan", true);
            
            let pickupDetail = "";
            if(pickupMethod === 'Ambil Sendiri') {
                const picker = document.getElementById('picker-name').value;
                if(!picker) return showToast("Isi Nama Pengambil", true);
                pickupDetail = `Oleh: ${picker}`;
            } else {
                pickupDetail = `(Kurir Urusan Pembeli)`;
            }

            let grandTotal = 0;
            const items = cart.map(i => {
                let fp = i.price - (i.price * (i.discount/100));
                grandTotal += (fp * i.qty);
                // Nama di cart sudah mengandung varian jika ada
                return String.fromCodePoint(0x1F3F7) + ` ${i.qty} ${i.unit} ${i.name} = ${formatRp(fp * i.qty)}`; 
            }).join('\n'); 

            let roundedTotal = grandTotal;

            const strukData = { 
                n: name, 
                d: pickupMethod, 
                p: pay, 
                dt: pickupDetail, 
                i: cart.map(i=>({n:i.name, p:i.price-(i.price*(i.discount/100)), q:i.qty, u:i.unit})), 
                t: roundedTotal 
            };
            const encodedData = btoa(unescape(encodeURIComponent(JSON.stringify(strukData))));
            const magicLink = BASE_URL_ONLINE + "?struk=" + encodedData;

            let msg = `üü¢ *[ORDER DARI WEBSITE]*\n\n`;
            msg += `Halo Kak Kasir Toko Obat Bintan Jaya, Saya mau pesan:\n\n`;
            msg += `${items}\n\n`;
            
            msg += `----------------------------------\n`;
	        msg += String.fromCodePoint(0x1F4B0) + ` Grand Total: ${formatRp(grandTotal)}\n`;
            msg += String.fromCodePoint(0x2705) + ` Total Bayar: ${formatRp(roundedTotal)}\n`;
            msg += `----------------------------------\n`;
            msg += String.fromCodePoint(0x1F464) + ` Nama: ${name}\n`;
            msg += String.fromCodePoint(0x1F69A) + ` Metode: ${pickupMethod}\n`;
            
            if(pickupMethod === 'Ambil Sendiri') {
                msg += String.fromCodePoint(0x1F91D) + ` Diambil: ${pickupDetail.replace('Oleh: ', '')}\n`;
            } else {
                msg += String.fromCodePoint(0x26A0) + ` Catatan: Kurir dipesan pembeli\n`;
            }

            msg += String.fromCodePoint(0x1F4B3) + ` Bayar: ${pay}\n`;
            msg += `----------------------------------\n`;
            msg += String.fromCodePoint(0x1F5A8) + ` *CETAK STRUK (Utk Kurir):*\n${magicLink}`;

            // --- REVISI: BERSIHKAN NOMOR WA DARI 08 JADI 628 ---
            let targetWA = APP_CONFIG.wa_order;
            // Hapus karakter non-digit (spasi, strip, plus)
            targetWA = targetWA.replace(/\D/g, ''); 
            // Jika diawali 08, ganti jadi 628
            if(targetWA.startsWith('08')) {
                targetWA = '62' + targetWA.substring(1);
            }

            window.open(`https://api.whatsapp.com/send?phone=${targetWA}&text=${encodeURIComponent(msg)}`, '_blank'); 

            cart = []; 
            saveCart(); 
            closeModal('checkout-modal'); 
            showPage('home-page');
            setTimeout(() => { document.getElementById('review-modal').style.display='block'; }, 1000);
        }

        // --- UPDATE TAMPILAN STRUK ---
        function showStruk(encodedData) { 
            try { 
                const jsonString = decodeURIComponent(escape(atob(encodedData))); 
                const data = JSON.parse(jsonString); 
                strukTotalBelanja = parseInt(data.t) || 0; 

                let strukHTML = ` 
                <div class="struk-container"> 
                    <div class="struk-header-row"> 
                        <img src="logostruleft.png" class="struk-logo" alt="Logo Kiri"> 
                        <div class="struk-title"> 
                            <h3>TOKO OBAT<br>BINTAN JAYA</h3> 
                            <p>${new Date().toLocaleString()}</p> 
                        </div> 
                        <img src="logostrukright.png" class="struk-logo" alt="Logo Kanan"> 
                    </div> 
                    
                    <div style="text-align:center; font-size:0.8rem; margin-bottom:15px; border-bottom:1px dashed #ccc; padding-bottom:10px;">
                        <strong>üìç ALAMAT PENGAMBILAN:</strong><br>
                        ${SHOP_ADDRESS}
                    </div>

                    <div class="struk-body"> 
                        <div class="struk-item"><span>Pemesan:</span> <strong>${data.n}</strong></div> 
                        <div class="struk-item"><span>Metode:</span> ${data.d}</div> 
                        <div class="struk-item"><span>Info:</span> ${data.dt || '-'}</div> 
                        <div class="struk-item"><span>Bayar:</span> ${data.p}</div> 
                        <hr style="border-top:1px dashed #ccc; margin:10px 0;"> `; 
                
                data.i.forEach(item => { 
                    let unitStr = item.u ? ` ${item.u}` : ''; 
                    strukHTML += ` 
                    <div class="struk-item" style="margin-bottom:8px;"> 
                        <div style="flex:1;">${item.n} <br> <small>${item.q}${unitStr} x ${formatRp(item.p)}</small></div> 
                        <div style="font-weight:bold;">${formatRp(item.p * item.q)}</div> 
                    </div>`; 
                }); 
                
                strukHTML += ` 
                    <hr style="border-top:1px dashed #ccc; margin:10px 0;"> 
                    <div class="struk-item struk-total" style="margin-top:10px;"> 
                        <span>TOTAL BAYAR</span> 
                        <span id="final-total">${formatRp(strukTotalBelanja)}</span> 
                    </div> 
                </div> 
                <div class="struk-footer">
                    Terima Kasih telah berbelanja!<br>
                    Tunjukkan struk ini saat pengambilan barang.
                </div> 
                </div>`; 
                
                document.getElementById('struk-content').innerHTML = strukHTML; 
                document.getElementById('struk-modal').style.display = 'block'; 
                document.getElementById('welcome-modal').style.display = 'none'; 
                document.getElementById('maintenance-screen').style.display = 'none'; 
            } catch (e) { showToast("Link struk tidak valid", true); } 
        }

        function openRequestModal() {
            const keyword = document.getElementById('search-input').value;
            document.getElementById('req-product').value = keyword;
            try {
                const visitor = sessionStorage.getItem('visitorName');
                if(visitor) document.getElementById('req-name').value = visitor;
            } catch(e){}
            const catSelect = document.getElementById('req-category');
            catSelect.innerHTML = '<option value="">-- Pilih Kategori --</option>';
            CATEGORY_MAP.forEach(c => {
                catSelect.innerHTML += `<option value="${c.label}">${c.icon} ${c.label}</option>`;
            });
            document.getElementById('request-modal').style.display = 'block';
        }

        function sendRequest() {
            const name = document.getElementById('req-name').value;
            const product = document.getElementById('req-product').value;
            const category = document.getElementById('req-category').value;
            const forWhom = document.querySelector('input[name="req-for"]:checked').value;
            const needType = document.querySelector('input[name="req-need"]:checked').value;
            const reason = document.getElementById('req-reason').value;

            if(!name || !product || !category || !reason) return showToast("Mohon lengkapi semua kolom", true);

            let msg = `*FORM REQUEST PRODUK*\n\n`;
            msg += `Halo Kak ` + String.fromCodePoint(0x1F44B) + `\nPerkenalkan, saya ${name}.\n\n`;
            msg += `Saya ingin mengajukan permintaan pengadaan produk berikut:\n`;
            msg += String.fromCodePoint(0x1F4E6) + ` Nama Produk : ${product}\n`;
            msg += String.fromCodePoint(0x1F4C2) + ` Kategori : ${category}\n`;
            msg += `----------------------------------\n`;
            msg += String.fromCodePoint(0x1F464) + ` Utk Siapa : ${forWhom}\n`;
            msg += String.fromCodePoint(0x1F6A8) + ` Kebutuhan : ${needType}\n`;
            msg += `----------------------------------\n`;
            msg += String.fromCodePoint(0x1F4DD) + ` Detail/Alasan:\n"${reason}"\n\n`;
            msg += String.fromCodePoint(0x2139) + ` _Note: ${name} menunggu info ketersediaan._\n\n`;
            msg += `----------------------------------\n`;
            msg += String.fromCodePoint(0x1F4CD) + ` Sumber : Website\n`;
            msg += String.fromCodePoint(0x23F0) + ` Waktu : ${new Date().toLocaleString('id-ID')}`;

            const targetNumber = APP_CONFIG.wa_request && APP_CONFIG.wa_request.length > 5 ? APP_CONFIG.wa_request : APP_CONFIG.wa_order;
            const waLink = `https://api.whatsapp.com/send?phone=${targetNumber}&text=${encodeURIComponent(msg)}`;
            window.open(waLink, '_blank');
            closeModal('request-modal');
        }

        // --- NEW: FUNGSI TOMBOL CHAT (CHAT BANTUAN) ---
        function openChatModal() {
            try {
                const visitor = sessionStorage.getItem('visitorName');
                if(visitor) document.getElementById('chat-name').value = visitor;
            } catch(e){}
            document.getElementById('chat-modal').style.display = 'block';
        }

        function sendChat() {
            const name = document.getElementById('chat-name').value;
            const message = document.getElementById('chat-msg').value;

            if(!name || !message) return showToast("Mohon isi nama dan pesan", true);

            const targetNumber = APP_CONFIG.wa_konsul && APP_CONFIG.wa_konsul.length > 5 ? APP_CONFIG.wa_konsul : APP_CONFIG.wa_order;

            let msg = `*${String.fromCodePoint(0x2728)} CHAT BANTUAN PELANGGAN*\n\n`;
            msg += `Halo Admin, saya *${name}*.\n`;
            msg += `Mau tanya/bantuan ${String.fromCodePoint(0x1F447)}:\n\n`;
            msg += `"${message}"\n\n`;
            msg += `_${String.fromCodePoint(0x1F310)} Dikirim dari Tombol Chat Website_`;

            const waLink = `https://api.whatsapp.com/send?phone=${targetNumber}&text=${encodeURIComponent(msg)}`;
            window.open(waLink, '_blank');
            closeModal('chat-modal');
        }

        function enterShop() { const name = document.getElementById('visitor-name').value; if(!name) { showToast("Mohon isi nama Anda", true); return; } try { sessionStorage.setItem('visitorName', name); } catch (e) {} document.getElementById('welcome-modal').style.display = 'none'; try { document.getElementById('cust-name').value = name; } catch(e) {} }
        function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active')); if(id==='home-page') document.getElementById('nav-home').classList.add('active'); if(id==='product-page') document.getElementById('nav-product').classList.add('active'); if(id === 'cart-page') renderCart(); }
        function adminLogin() { document.getElementById('admin-login-form').style.display = 'block'; document.getElementById('admin-dashboard').style.display = 'none'; document.getElementById('login-modal').style.display = 'block'; }
        function checkAdmin() { if(document.getElementById('admin-pass').value === APP_CONFIG.pass_admin) { showToast("Login Berhasil!"); document.getElementById('admin-login-form').style.display = 'none'; document.getElementById('admin-dashboard').style.display = 'block'; } else { showToast("Password Salah!", true); } }
        function openAdminLink(type) { let url = ""; if(type === 'master') url = APP_CONFIG.link_master; if(type === 'form') url = APP_CONFIG.link_form; if(type === 'laporan') url = APP_CONFIG.link_laporan; if(url && url.length > 5) window.open(url, '_blank'); else showToast("Link belum disetting di Excel", true); }
    
        // --- FUNGSI BARU: BUKA MODAL FAQ ---
        function openFAQModal() {
            document.getElementById('faq-modal').style.display = 'block';
        }
    </script>
<script>
    // PWA REGISTRATION SCRIPT
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => console.log('PWA Service Worker Registered!', reg))
                .catch(err => console.log('PWA Error:', err));
        });
    }
</script>
</body>
</html>
